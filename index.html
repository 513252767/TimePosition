<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间显示与随机码</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            padding-top: 50px;
        }

        h1, p {
            color: #333;
        }

        .datetime {
            font-size: 1em;
        }

        .time {
            margin-top: 10px;
            font-size: 1em;
        }

        .large-code {
            font-size: 8em;
        }

        @media screen and (max-width: 768px) and (orientation: landscape) {
            body {
                transform: rotate(90deg);
                width: 100vh;
                height: 100vw;
                padding-top: 0;
                padding-bottom: 0;
            }
            h1, p {
                font-size: 2em;
                margin: 10px;
            }
        }
    </style>
    <script>
        function updateTime() {
            var now = new Date();
            var dateString = now.toISOString().substring(0, 10);
            var timeString = now.toLocaleTimeString();
            document.getElementById('date').innerHTML = "时间: " + dateString + " " + timeString;
        }

        function hashDateAndHour(dateString, hour) {
            var hash = 0, i, chr;
            var fixedString = "randomSeed";
            var combinedString = dateString + hour.toString().padStart(2, '0') + fixedString;

            for (i = 0; i < combinedString.length; i++) {
                chr = combinedString.charCodeAt(i);
                hash = ((hash << 5) - hash + chr) ^ (chr >>> 16);
            }

            return Math.abs(hash).toString().padStart(4, '0').slice(-4);
        }

        function getVerificationPeriod(hour) {
            if (hour >= 19 || hour < 7) {
                return "19:00 - 07:00";
            } else {
                var startHour = Math.floor(hour / 2) * 2;
                var endHour = startHour + 2;
                return startHour.toString().padStart(2, '0') + ':00 - ' + endHour.toString().padStart(2, '0') + ':00';
            }
        }

        function updateCode() {
            var date = new Date();
            var dateString = date.toISOString().substring(0, 10);
            var hour = date.getHours();
            
            var standardizedHour = Math.floor((hour-1) / 2) * 2+1; // 通过向下取整，保证小时固定为每两小时一个区间
            var period = getVerificationPeriod(standardizedHour);
            if (standardizedHour >= 19 || standardizedHour < 7) {
                standardizedHour=19;
                if(standardizedHour>=0){
                    date.setDate(date.getDate()-1);
                    dateString = date.toISOString().substring(0, 10);
                }
            }
            var code = hashDateAndHour(dateString, standardizedHour);
            document.getElementById('period').innerHTML = "随机码有效时段: " + period;
            document.getElementById('code').innerHTML = code;
        }

        function checkOrientation() {
            var isMobile = (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
            if (isMobile && window.orientation === 90 || window.orientation === -90) {
                document.body.style.transform = "rotate(90deg)";
                document.body.style.width = "100vh";
                document.body.style.height = "100vw";
            } else {
                document.body.style.transform = "";
                document.body.style.width = "";
                document.body.style.height = "";
            }
        }

        function initialize() {
            updateTime();
            updateCode();
            checkOrientation();

            setInterval(updateTime, 1000); 

            var hour = new Date().getHours();
            if (hour >= 7 && hour < 19) {
                setInterval(updateCode, 60000 * 60 * 2); // 每两小时更新验证码
            }
            
            window.addEventListener('orientationchange', checkOrientation);
        }

        window.onload = initialize;
    </script>
</head>
<body>
    <h1>
        <p id="date" class="datetime"></p>
        <p id="time" class="time"></p>
    </h1>
    <p id="period">随机码有效时段:</p>
    <p><span class="large-code" id="code"></span></p>
</body>
</html>
