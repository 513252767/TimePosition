<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间显示与验证码</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            padding-top: 50px;
        }

        h1, p {
            color: #333;
            font-size: 2em; /* 缩小字体大小 */
        }

        span {
            display: inline-block;
        }

        /* 手机端横屏显示的样式 */
        @media screen and (max-width: 768px) and (orientation: landscape) {
            body {
                transform: rotate(90deg);
                width: 100vh;
                height: 100vw;
                padding-top: 0;
                padding-bottom: 0;
            }
            h1, p {
                font-size: 2em;
                margin: 10px;
            }
        }
    </style>
    <script>
        function updateTime() {
            var now = new Date();
            var timeString = now.toLocaleTimeString();
            document.getElementById('time').innerHTML = timeString;
        }

        function hashDateAndHour(dateString, hour) {
            var hash = 0, i, chr;
            var fixedString = "randomSeed"; // 固定字符串增强随机性
            
            // 将日期字符串与小时数拼接在一起
            var combinedString = dateString + hour.toString().padStart(2, '0') + fixedString;
            
            if (combinedString.length === 0) return hash;
            
            for (i = 0; i < combinedString.length; i++) {
                chr = combinedString.charCodeAt(i);
                hash = ((hash << 5) - hash + chr) ^ (chr >>> 16);
            }
            
            // 取绝对值并保留四位数
            return Math.abs(hash).toString().padStart(4, '0').slice(-4);
        }

        function getVerificationPeriod(hour) {
            var startHour = Math.floor(hour / 2) * 2;
            var endHour = startHour + 2;
            return startHour.toString().padStart(2, '0') + ':00 - ' + endHour.toString().padStart(2, '0') + ':00';
        }

        function updateCode() {
            var date = new Date();
            var dateString = date.toISOString().substring(0, 10); // YYYY-MM-DD
            var hour = date.getHours();
            var period = getVerificationPeriod(hour);
            var code = hashDateAndHour(dateString, hour);
            document.getElementById('code').innerHTML = "(" + period + "):\n " + code;
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var latitude = position.coords.latitude.toFixed(6);
                        var longitude = position.coords.longitude.toFixed(6);
                        document.getElementById('location').innerHTML = "纬度: " + latitude + "\n经度: " + longitude;
                    },
                    function(error) {
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                document.getElementById('location').innerHTML = "您拒绝了位置请求权限。";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                document.getElementById('location').innerHTML = "位置信息不可用。";
                                break;
                            case error.TIMEOUT:
                                document.getElementById('location').innerHTML = "请求用户地理位置超时。";
                                break;
                            case error.UNKNOWN_ERROR:
                                document.getElementById('location').innerHTML = "未知错误。";
                                break;
                        }
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            } else {
                document.getElementById('location').innerHTML = "您的浏览器不支持地理定位功能。";
            }
        }

        function checkOrientation() {
            var isMobile = (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
            if (isMobile && window.orientation === 90 || window.orientation === -90) {
                // 强制横屏显示
                document.body.style.transform = "rotate(90deg)";
                document.body.style.width = "100vh";
                document.body.style.height = "100vw";
            } else {
                // 恢复正常显示
                document.body.style.transform = "";
                document.body.style.width = "";
                document.body.style.height = "";
            }
        }

        function initialize() {
            updateTime();
            updateCode();
            getLocation();
            checkOrientation(); // 检查设备方向
            setInterval(updateTime, 1000); // 每秒更新时间
            setInterval(updateCode, 60000); // 每分钟检查是否需要更新验证码
            window.addEventListener('orientationchange', checkOrientation); // 监听方向变化
        }

        window.onload = initialize;
    </script>
</head>
<body>
    <h1>当前时间: <span id="time"></span></h1>
    <p>验证码: <span id="code"></span></p>
    <p>当前位置: <span id="location"></span></p>
</body>
</html>